# windows release build: mingw64 g++ from MSYS2 (currently 9.1.1) on Windows Server 2012 R2
image:
  - Visual Studio 2015
install:
  - cd ..
  - set PATH=C:\msys64\usr\bin;%PATH%
  # download muparser & gmp as static libraries
  - appveyor DownloadFile "https://github.com/lkeegan/libsbml-static/releases/latest/download/libsbml-static-windows.zip"
  - 7z x libsbml-static-windows.zip
  - mv muparser C:\msys64\home\appveyor\.
  - mv gmp C:\msys64\home\appveyor\.

build_script:
  - set WORKING_DIR=%CD%
  - echo "%WORKING_DIR%"
  - echo 'CMAKE_FLAGS+=" -DDUNE_PYTHON_VIRTUALENV_SETUP=1 -DDUNE_PYTHON_VIRTUALENV_PATH=%WORKING_DIR%/dune-python-venv"' >> dune.opts
  - echo 'CMAKE_FLAGS+=" -G '"'"'Unix Makefiles'"'"' -DGMPXX_INCLUDE_DIR:PATH='"%WORKING_DIR%"'/gmp/include -DGMPXX_LIB:FILEPATH='"%WORKING_DIR%"'/gmp/lib/libgmpxx.a -DGMP_LIB:FILEPATH='"%WORKING_DIR%"'/gmp/lib/libgmp.a -DCMAKE_DISABLE_FIND_PACKAGE_QuadMath=TRUE -DBUILD_TESTING=OFF -DDUNE_USE_ONLY_STATIC_LIBS=ON -DCMAKE_BUILD_TYPE=Release -DCMAKE_PREFIX_PATH='"%WORKING_DIR%"'/muparser -DF77=true -DCMAKE_CXX_FLAGS='"'"'-Wa,-mbig-obj -static -static-libgcc -static-libstdc++'"'"' "' > dune.opts
  - set DUNE_OPTIONS_FILE="%WORKING_DIR%\dune.opts"
  - echo "%DUNE_OPTIONS_FILE%"
  - cp dune-copasi\.ci\setup.sh C:\msys64\home\appveyor\.
  - bash -l setup.sh